<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Bayesian modelling and quantification of Raman spectroscopy — serrsBayes • serrsBayes</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Bayesian modelling and quantification of Raman spectroscopy — serrsBayes" />
<meta property="og:description" content="This R package implements sequential Monte Carlo (SMC) algorithms for fitting a
generalised additive mixed model (GAMM) to Raman spectra. These multivariate observations are highly collinear
and lend themselves to a reduced-rank representation.  The GAMM separates the
hyperspectral signal into three components: a sequence of Lorentzian or Gaussian peaks; a
smoothly-varying baseline; and zero-mean, additive white noise. The parameters of each component of
the model are estimated iteratively using SMC. The posterior distributions of the parameters
given the observed spectra are represented as a population of weighted particles." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">serrsBayes</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.4-2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/Introduction.html">Introducing serrsBayes</a>
    </li>
    <li>
      <a href="../articles/Methanol.html">Methanol example</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/mooresm/serrsBayes/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Bayesian modelling and quantification of Raman spectroscopy</h1>
    <small class="dont-index">Source: <a href='https://github.com/mooresm/serrsBayes/blob/master/R/serrsBayes.R'><code>R/serrsBayes.R</code></a></small>
    <div class="hidden name"><code>serrsBayes.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This R package implements sequential Monte Carlo (SMC) algorithms for fitting a
generalised additive mixed model (GAMM) to Raman spectra. These multivariate observations are highly collinear
and lend themselves to a reduced-rank representation.  The GAMM separates the
hyperspectral signal into three components: a sequence of Lorentzian or Gaussian peaks; a
smoothly-varying baseline; and zero-mean, additive white noise. The parameters of each component of
the model are estimated iteratively using SMC. The posterior distributions of the parameters
given the observed spectra are represented as a population of weighted particles.</p>
    </div>



    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Raman spectroscopy can be used to identify molecules by the characteristic scattering of light from a laser.
The pattern of peaks in a Raman spectrum corresponds to the vibrational modes of the molecule. The shift in
wavenumber of the photons is proportional to the change in energy state, which is reflected in the locations
of the peaks. Surface-enhanced Raman scattering (SERS) is a technique that amplifies the Raman
signal using metallic substrates, such as nanoparticles. The laser can also be tuned to the resonant frequency
of the molecule, which is known as surface-enhanced resonance Raman scattering (SERRS). Under controlled experimental
conditions, the amplitudes of the peaks are linearly related to the concentration of the molecule, from the limit
of detection (LOD) up to monolayer coverage of the nanoparticle surface.</p>
<p>The GAMM represents the peaks and baseline as continuous functions. The background fluorescence is modelled
using a penalised cubic spline, while the peaks are an additive mixture of squared exponential (Gaussian) or Lorentzian
(Cauchy) kernels:
$$Y = \sum_{m=1}^M \alpha_{i,m}B_m(\nu_j) + \sum_{p=1}^P s(\nu_j | l_p, A_p, \phi_p) + \epsilon_{i,j}$$
where \(Y\) is a matrix of hyperspectral observations \(y_{i,j}\) that have been discretised at wavenumbers \(\nu_j\);
\(B_m\) are the \(M\) spline basis functions with coefficients \(\alpha_{i,m}\); \(s(\nu_j | l_p, A_p, \phi_p)\) 
are the radial basis functions for each peak, with location \(l_p\), amplitude \(A_p\), and scale \(\phi_p\) parameters.
\(\epsilon_{i,j}\) is assumed to be zero mean, additive white noise with constant variance \(\sigma^2\).</p>
<p>This model-based approach accounts for differences in resolution and experimental conditions,
enabling comparison and alignment of heterogeneous spectra. The relationship between concentration
and peak intensity can be quantified by fitting a Bayesian functional regression:
$$A_p = c_i \beta_p$$
where \(c_i\) is the nanomolar (nM) concentration of the molecule in the \(i\)th spectrum,
\(c_{LOD} &lt; c_i &lt;= c_{MLC}\). The regression model produces highest posterior density (HPD) intervals for the
limit of detection of each peak. A consistent, unbiased estimate of the model evidence (also known as the marginal likelihood)
is also computed. This can be used to evaluate whether Gaussian or Lorentzian peaks are a better fit to the data.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Moores, Gracie, Carson, Faulds, Graham &amp; Girolami "Bayesian modelling and quantification of Raman spectroscopy," <a href='https://arxiv.org/abs/1604.07299'>arXiv preprint</a></p>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>M. T. Moores, J. Carson &amp; M. Girolami</p>
<p>Maintainer: Matt Moores &lt;mmoores@gmail.com&gt;</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># simulate some data with known parameter values</span>
<span class='va'>wavenumbers</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='fl'>700</span>,<span class='fl'>1400</span>,by<span class='op'>=</span><span class='fl'>2</span><span class='op'>)</span>
<span class='va'>spectra</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span>nrow<span class='op'>=</span><span class='fl'>1</span>, ncol<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>wavenumbers</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>peakLocations</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>840</span>,  <span class='fl'>960</span>, <span class='fl'>1140</span>, <span class='fl'>1220</span>, <span class='fl'>1290</span><span class='op'>)</span>
<span class='va'>peakAmplitude</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>11500</span>, <span class='fl'>2500</span>, <span class='fl'>4000</span>, <span class='fl'>3000</span>, <span class='fl'>2500</span><span class='op'>)</span>
<span class='va'>peakScale</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>10</span>, <span class='fl'>15</span>, <span class='fl'>20</span>, <span class='fl'>10</span>, <span class='fl'>12</span><span class='op'>)</span>
<span class='va'>signature</span> <span class='op'>&lt;-</span> <span class='fu'><a href='weightedLorentzian.html'>weightedLorentzian</a></span><span class='op'>(</span><span class='va'>peakLocations</span>, <span class='va'>peakScale</span>, <span class='va'>peakAmplitude</span>, <span class='va'>wavenumbers</span><span class='op'>)</span>
<span class='va'>baseline</span> <span class='op'>&lt;-</span> <span class='fl'>1000</span><span class='op'>*</span><span class='fu'><a href='https://rdrr.io/r/base/Trig.html'>cos</a></span><span class='op'>(</span><span class='va'>wavenumbers</span><span class='op'>/</span><span class='fl'>200</span><span class='op'>)</span> <span class='op'>+</span> <span class='fl'>2</span><span class='op'>*</span><span class='va'>wavenumbers</span>
<span class='va'>spectra</span><span class='op'>[</span><span class='fl'>1</span>,<span class='op'>]</span> <span class='op'>&lt;-</span> <span class='va'>signature</span> <span class='op'>+</span> <span class='va'>baseline</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>wavenumbers</span><span class='op'>)</span>,<span class='fl'>0</span>,<span class='fl'>200</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>wavenumbers</span>, <span class='va'>spectra</span><span class='op'>[</span><span class='fl'>1</span>,<span class='op'>]</span>, type<span class='op'>=</span><span class='st'>'l'</span>, xlab<span class='op'>=</span><span class='st'>"Raman offset"</span>, ylab<span class='op'>=</span><span class='st'>"intensity"</span><span class='op'>)</span>
</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/graphics/lines.html'>lines</a></span><span class='op'>(</span><span class='va'>wavenumbers</span>, <span class='va'>baseline</span>, col<span class='op'>=</span><span class='fl'>2</span>, lty<span class='op'>=</span><span class='fl'>4</span><span class='op'>)</span>
</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/graphics/lines.html'>lines</a></span><span class='op'>(</span><span class='va'>wavenumbers</span>, <span class='va'>baseline</span> <span class='op'>+</span> <span class='va'>signature</span>, col<span class='op'>=</span><span class='fl'>4</span>, lty<span class='op'>=</span><span class='fl'>2</span><span class='op'>)</span>
</div><div class='img'><img src='serrsBayes-1.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'># fit the model using SMC</span>
<span class='va'>lPriors</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>scale.mu<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='fl'>11.6</span><span class='op'>)</span> <span class='op'>-</span> <span class='op'>(</span><span class='fl'>0.4</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>/</span><span class='fl'>2</span>, scale.sd<span class='op'>=</span><span class='fl'>0.4</span>, bl.smooth<span class='op'>=</span><span class='fl'>10</span><span class='op'>^</span><span class='fl'>11</span>, bl.knots<span class='op'>=</span><span class='fl'>50</span>,
                beta.mu<span class='op'>=</span><span class='fl'>5000</span>, beta.sd<span class='op'>=</span><span class='fl'>5000</span>, noise.sd<span class='op'>=</span><span class='fl'>200</span>, noise.nu<span class='op'>=</span><span class='fl'>4</span><span class='op'>)</span>

<span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
<span class='co'>## takes approx. 1 minute for 100 SMC iterations with 10,000 particles</span>
<span class='va'>result</span> <span class='op'>&lt;-</span> <span class='fu'><a href='fitSpectraSMC.html'>fitSpectraSMC</a></span><span class='op'>(</span><span class='va'>wavenumbers</span>, <span class='va'>spectra</span>, <span class='va'>peakLocations</span>, <span class='va'>lPriors</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/stats/plot.ts.html'>plot.ts</a></span><span class='op'>(</span><span class='va'>result</span><span class='op'>$</span><span class='va'>ess</span>, xlab<span class='op'>=</span><span class='st'>"SMC iterations"</span>, ylab<span class='op'>=</span><span class='st'>"ESS"</span><span class='op'>)</span>

<span class='co'># sample 200 particles from the posterior distribution</span>
<span class='va'>samp.idx</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample.int</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>result</span><span class='op'>$</span><span class='va'>weights</span><span class='op'>)</span>, <span class='fl'>200</span>, prob<span class='op'>=</span><span class='va'>result</span><span class='op'>$</span><span class='va'>weights</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>wavenumbers</span>, <span class='va'>spectra</span><span class='op'>[</span><span class='fl'>1</span>,<span class='op'>]</span>, type<span class='op'>=</span><span class='st'>'l'</span>, xlab<span class='op'>=</span><span class='st'>"Raman offset"</span>, ylab<span class='op'>=</span><span class='st'>"intensity"</span><span class='op'>)</span>
<span class='kw'>for</span> <span class='op'>(</span><span class='va'>pt</span> <span class='kw'>in</span> <span class='va'>samp.idx</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>bl.est</span> <span class='op'>&lt;-</span> <span class='va'>result</span><span class='op'>$</span><span class='va'>basis</span> <span class='op'>%*%</span> <span class='va'>result</span><span class='op'>$</span><span class='va'>alpha</span><span class='op'>[</span>,<span class='fl'>1</span>,<span class='va'>pt</span><span class='op'>]</span>
  <span class='fu'><a href='https://rdrr.io/r/graphics/lines.html'>lines</a></span><span class='op'>(</span><span class='va'>wavenumbers</span>, <span class='va'>bl.est</span>, col<span class='op'>=</span><span class='st'>"#C3000009"</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/graphics/lines.html'>lines</a></span><span class='op'>(</span><span class='va'>wavenumbers</span>, <span class='va'>bl.est</span> <span class='op'>+</span> <span class='va'>result</span><span class='op'>$</span><span class='va'>expFn</span><span class='op'>[</span><span class='va'>pt</span>,<span class='op'>]</span>, col<span class='op'>=</span><span class='st'>"#0000C309"</span><span class='op'>)</span>
<span class='op'>}</span>
<span class='op'>}</span>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Matt Moores, Jake Carson, Mark Girolami, Engineering and Physical Sciences Research Council.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


